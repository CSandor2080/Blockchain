<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Loyalty Points System</title>
    <!-- Tailwind CSS -->
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <!-- Material Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
</head>
<body class="bg-gray-100 font-sans p-8">
    <div class="max-w-4xl mx-auto bg-white shadow-lg rounded-lg p-8">
        <h1 class="text-3xl font-bold text-center text-gray-800 mb-8">Loyalty Points System</h1>

        <!-- Get Wallets -->
        <h2 class="text-2xl font-semibold text-gray-700 mb-4 flex items-center">
            <span class="material-icons mr-2">account_balance_wallet</span>Get Wallets
        </h2>
        <button class="btn bg-green-600 text-white py-2 px-4 rounded-md hover:bg-green-700 mb-4" onclick="getWallets()">Get Wallets</button>
        <pre id="walletsOutput" class="bg-gray-100 p-4 rounded-md border border-gray-300 mb-8 max-h-64 overflow-y-scroll"></pre>

        <!-- Get Account Balance -->
        <h2 class="text-2xl font-semibold text-gray-700 mb-4 flex items-center">
            <span class="material-icons mr-2">account_balance</span>Get Account Balance
        </h2>
        <input type="text" id="balanceAccount" class="form-control bg-gray-100 p-4 rounded-md border border-gray-300 mb-4 w-full" placeholder="Account Address">
        <button class="btn bg-green-600 text-white py-2 px-4 rounded-md hover:bg-green-700 mb-4" onclick="getAccountBalance()">Get Balance</button>
        <pre id="balanceOutput" class="bg-gray-100 p-4 rounded-md border border-gray-300 mb-8 max-h-64 overflow-y-scroll"></pre>

        <!-- Issue Points -->
        <h2 class="text-2xl font-semibold text-gray-700 mb-4 flex items-center">
            <span class="material-icons mr-2">card_giftcard</span>Issue Points
        </h2>
        <input type="text" id="issueTo" class="form-control bg-gray-100 p-4 rounded-md border border-gray-300 mb-4 w-full" placeholder="To Address">
        <input type="number" id="issuePoints" class="form-control bg-gray-100 p-4 rounded-md border border-gray-300 mb-4 w-full" placeholder="Points">
        <button class="btn bg-green-600 text-white py-2 px-4 rounded-md hover:bg-green-700 mb-4" onclick="issuePoints()">Issue Points</button>
        <pre id="issueOutput" class="bg-gray-100 p-4 rounded-md border border-gray-300 mb-8 max-h-64 overflow-y-scroll"></pre>

        <!-- Redeem Points -->
        <h2 class="text-2xl font-semibold text-gray-700 mb-4 flex items-center">
            <span class="material-icons mr-2">redeem</span>Redeem Points
        </h2>
        <input type="text" id="redeemTo" class="form-control bg-gray-100 p-4 rounded-md border border-gray-300 mb-4 w-full" placeholder="To Address">
        <input type="number" id="redeemPoints" class="form-control bg-gray-100 p-4 rounded-md border border-gray-300 mb-4 w-full" placeholder="Points">
        <button class="btn bg-green-600 text-white py-2 px-4 rounded-md hover:bg-green-700 mb-4" onclick="redeemPoints()">Redeem Points</button>
        <pre id="redeemOutput" class="bg-gray-100 p-4 rounded-md border border-gray-300 mb-8 max-h-64 overflow-y-scroll"></pre>

        <!-- Purchase Beverage -->
        <h2 class="text-2xl font-semibold text-gray-700 mb-4 flex items-center">
            <span class="material-icons mr-2">local_cafe</span>Purchase Beverage
        </h2>
        <input type="text" id="purchaseCustomer" class="form-control bg-gray-100 p-4 rounded-md border border-gray-300 mb-4 w-full" placeholder="Customer Address">
        <button class="btn bg-green-600 text-white py-2 px-4 rounded-md hover:bg-green-700 mb-4" onclick="purchaseBeverage()">Purchase</button>
        <pre id="purchaseOutput" class="bg-gray-100 p-4 rounded-md border border-gray-300 mb-8 max-h-64 overflow-y-scroll"></pre>

        <!-- Redeem Beverage -->
        <h2 class="text-2xl font-semibold text-gray-700 mb-4 flex items-center">
            <span class="material-icons mr-2">redeem</span>Redeem Beverage
        </h2>
        <input type="text" id="redeemBevCustomer" class="form-control bg-gray-100 p-4 rounded-md border border-gray-300 mb-4 w-full" placeholder="Customer Address">
        <input type="number" id="redeemBevPoints" class="form-control bg-gray-100 p-4 rounded-md border border-gray-300 mb-4 w-full" placeholder="Points">
        <button class="btn bg-green-600 text-white py-2 px-4 rounded-md hover:bg-green-700 mb-4" onclick="redeemBeverage()">Redeem</button>
        <pre id="redeemBevOutput" class="bg-gray-100 p-4 rounded-md border border-gray-300 mb-8 max-h-64 overflow-y-scroll"></pre>

        <!-- Get Points Balance -->
        <h2 class="text-2xl font-semibold text-gray-700 mb-4 flex items-center">
            <span class="material-icons mr-2">account_balance_wallet</span>Get Points Balance
        </h2>
        <input type="text" id="balancePoint" class="form-control bg-gray-100 p-4 rounded-md border border-gray-300 mb-4 w-full" placeholder="Account Address">
        <button class="btn bg-green-600 text-white py-2 px-4 rounded-md hover:bg-green-700 mb-4" onclick="getPointsBalance()">Get Points Balance</button>
        <pre id="pointsBalanceOutput" class="bg-gray-100 p-4 rounded-md border border-gray-300 mb-8 max-h-64 overflow-y-scroll"></pre>
    </div>


<script>
    const apiBaseUrl = 'http://127.0.0.1:8080'; // Replace with your FastAPI backend URL

    // Utility function to convert objects to HTML lists
    function jsonToHtmlList(data) {
        let html = '<ul class="list-disc ml-6">';
        for (const key in data) {
            const value = typeof data[key] === 'object' ? jsonToHtmlList(data[key]) : data[key];
            html += `<li><strong>${key}:</strong> ${value}</li>`;
        }
        html += '</ul>';
        return html;
    }

    // Fetch and display the list of wallets
    async function getWallets() {
        const response = await fetch(`${apiBaseUrl}/wallets`);
        const data = await response.json();
        document.getElementById('walletsOutput').innerHTML = jsonToHtmlList(data);
    }

    // Fetch and display the balance of a specific account
    async function getAccountBalance() {
        const account = document.getElementById('balanceAccount').value;
        const response = await fetch(`${apiBaseUrl}/balance/${account}`);
        const data = await response.json();
        document.getElementById('balanceOutput').innerHTML = jsonToHtmlList(data);
    }

    // Issue loyalty points to a specified address
    async function issuePoints() {
        const to = document.getElementById('issueTo').value;
        const points = document.getElementById('issuePoints').value;
        const response = await fetch(`${apiBaseUrl}/issue-points/${to}/${points}`, { method: 'POST' });
        const data = await response.json();
        document.getElementById('issueOutput').innerHTML = jsonToHtmlList(data);
    }

    // Redeem points for a specified address
    async function redeemPoints() {
        const to = document.getElementById('redeemTo').value;
        const points = document.getElementById('redeemPoints').value;
        const response = await fetch(`${apiBaseUrl}/redeem-points/${to}/${points}`, { method: 'POST' });
        const data = await response.json();
        document.getElementById('redeemOutput').innerHTML = jsonToHtmlList(data);
    }

    // Purchase a beverage, issuing points to the customer
    async function purchaseBeverage() {
        const customer = document.getElementById('purchaseCustomer').value;
        const response = await fetch(`${apiBaseUrl}/purchase-beverage/${customer}`, { method: 'POST' });
        const data = await response.json();
        document.getElementById('purchaseOutput').innerHTML = jsonToHtmlList(data);
    }

    // Redeem beverages for points
    async function redeemBeverage() {
        const customer = document.getElementById('redeemBevCustomer').value;
        const points = document.getElementById('redeemBevPoints').value;
        const response = await fetch(`${apiBaseUrl}/redeem-beverage/${customer}/${points}`, { method: 'POST' });
        const data = await response.json();
        document.getElementById('redeemBevOutput').innerHTML = jsonToHtmlList(data);
    }

    // Fetch and display the balance of loyalty points
    async function getPointsBalance() {
        const account = document.getElementById('balancePoint').value;
        const response = await fetch(`${apiBaseUrl}/points-balance/${account}`);
        const data = await response.json();
        document.getElementById('pointsBalanceOutput').innerHTML = jsonToHtmlList(data);
    }
</script>

</body>
</html>
